---
// Theme toggle switch
---

<button
  id="theme-toggle"
  class="toggle-switch"
  aria-label="Toggle theme"
  role="switch"
>
  <span class="toggle-track">
    <span class="toggle-thumb"></span>
  </span>
</button>

<style is:global>
  .toggle-switch {
    position: relative;
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
  }

  .toggle-track {
    display: block;
    width: 36px;
    height: 20px;
    background-color: var(--color-text);
    border-radius: 10px;
    position: relative;
    transition: background-color 0.2s ease;
  }

  .toggle-thumb {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 16px;
    height: 16px;
    background-color: var(--color-bg);
    border-radius: 50%;
    transition: transform 0.2s ease, background-color 0.2s ease;
    transform: translateX(0);
  }

  [data-theme="dark"] .toggle-thumb {
    transform: translateX(16px);
  }
</style>

<script>
  function setupThemeToggle() {
    const toggle = document.getElementById('theme-toggle');

    const updateAriaState = () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      toggle?.setAttribute('aria-checked', isDark ? 'true' : 'false');
    };

    toggle?.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateAriaState();
    });

    updateAriaState();
  }

  setupThemeToggle();
  document.addEventListener('astro:after-swap', setupThemeToggle);
</script>
